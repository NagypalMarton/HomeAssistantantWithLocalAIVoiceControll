version: "3.8"

services:
  config:
    build: ./services/config
    container_name: config
    environment:
      - CONFIG_DIR=/app/config
    volumes:
      - config_data:/app/config
    ports:
      - "8000:8000"
    restart: unless-stopped
    networks:
      - wyoming

  wakeword:
    build: ./services/wakeword
    container_name: wakeword
    environment:
      - WAKE_WORD=alexa
      - THRESHOLD=0.5
    restart: unless-stopped
    networks:
      - wyoming

  stt:
    build: ./services/stt
    container_name: stt
    environment:
      - WHISPER_MODEL=tiny
      - WHISPER_LANGUAGE=hu
      - BEAM_SIZE=1
    volumes:
      - whisper_data:/data
    restart: unless-stopped
    networks:
      - wyoming

  piper:
    build: ./services/piper
    container_name: piper
    environment:
      - PIPER_VOICE=hu_HU-anna-medium
    restart: unless-stopped
    networks:
      - wyoming

  orchestrator:
    build: ./services/orchestrator
    container_name: orchestrator
    environment:
      - SAMPLE_RATE=16000
      - RECORD_SECONDS=5
      - STT_URI=tcp://stt:10300
      - TTS_URI=tcp://piper:10200
      - WAKEWORD_URI=tcp://wakeword:10400
      - CONFIG_FILE=/app/config/ha_config.json
    devices:
      - /dev/snd:/dev/snd
    group_add:
      - audio
    volumes:
      - config_data:/app/config
    depends_on:
      - stt
      - piper
      - wakeword
    restart: unless-stopped
    networks:
      - wyoming

networks:
  wyoming:
    driver: bridge

volumes:
  whisper_data:
  config_data:
