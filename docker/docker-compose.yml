services:
  home-assistant:
    container_name: homeassistant
    image: homeassistant/home-assistant:latest
    volumes:
      - ./home-assistant/config:/config
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "8123:8123"
    restart: unless-stopped
    privileged: true
    network_mode: host
    environment:
      - TZ=Europe/Budapest

  ollama:
    container_name: ollama
    build: ./ollama
    volumes:
      - ollama-data:/root/.ollama
    ports:
      - "11434:11434"
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility

  zabbix-postgres:
    container_name: zabbix-postgres
    image: postgres:15-alpine
    volumes:
      - zabbix-postgres-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=zabbix
      - POSTGRES_PASSWORD=zabbix_password
      - POSTGRES_DB=zabbix
    restart: unless-stopped

  zabbix-server:
    container_name: zabbix-server
    image: zabbix/zabbix-server-pgsql:alpine-latest
    ports:
      - "10051:10051"
    volumes:
      - /etc/localtime:/etc/localtime:ro
    environment:
      - DB_SERVER_HOST=zabbix-postgres
      - POSTGRES_USER=zabbix
      - POSTGRES_PASSWORD=zabbix_password
      - POSTGRES_DB=zabbix
    depends_on:
      - zabbix-postgres
    restart: unless-stopped

  zabbix-web:
    container_name: zabbix-web
    image: zabbix/zabbix-web-nginx-pgsql:alpine-latest
    ports:
      - "8080:8080"
    environment:
      - DB_SERVER_HOST=zabbix-postgres
      - POSTGRES_USER=zabbix
      - POSTGRES_PASSWORD=zabbix_password
      - POSTGRES_DB=zabbix
      - ZBX_SERVER_HOST=zabbix-server
      - PHP_TZ=Europe/Budapest
    depends_on:
      - zabbix-server
      - zabbix-postgres
    restart: unless-stopped

  zabbix-agent:
    container_name: zabbix-agent
    image: zabbix/zabbix-agent:alpine-latest
    ports:
      - "10050:10050"
    environment:
      - ZBX_HOSTNAME=docker-host
      - ZBX_SERVER_HOST=zabbix-server
    restart: unless-stopped

volumes:
  ollama-data:
  zabbix-postgres-data:
